<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Driver App</title>
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=" />
  <link rel="stylesheet" href="/static/driver.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
</head>
<body>
  <header>
    <h1>Driver App</h1>
    <nav><a href="/">Home</a> · <a href="/docs" target="_blank">Docs</a> · <a href="/swagger" target="_blank">API Console</a></nav>
    <link rel="manifest" href="/static/manifest.json"/>
  </header>
  <section id="auth">
    <h2>Settings</h2>
    <div id="hosMini" class="mini" aria-live="polite"></div>
    <label>Tenant <input id="tenant" placeholder="t_demo"/></label>
    <label>Driver ID <input id="driverId" placeholder="drv1"/></label>
    <label><input type="checkbox" id="devToken" checked/> Use dev token (tenant:driver)</label>
    <button id="save">Save</button>
  </section>
  <section id="hos">
    <h2>HOS</h2>
    <button data-action="shift/start">Shift Start</button>
    <button data-action="shift/end">Shift End</button>
    <button data-action="breaks/start">Break Start</button>
    <button data-action="breaks/end">Break End</button>
    <pre id="hosOut"></pre>
  </section>
  <section id="myRoutes">
    <h2>My Active Routes</h2>
    <button id="refreshRoutes">Refresh</button>
    <ul id="routesList"></ul>
  </section>
  <section id="route">
    <h2>Route</h2>
    <label for="routeId">Route ID</label> <input id="routeId" placeholder="route_123"/>
    <label for="routeSelect">Quick Select</label>
    <select id="routeSelect" title="Select a route"><option value="">(select)</option></select>
    <button id="loadRoute">Load</button>
    <button id="connectSSE">Connect Events</button>
    <label class="ml-8"><input type="checkbox" id="autoRefresh" checked/> Auto-refresh list/events</label>
    <span class="help">Shortcuts: <span class="kbd">A</span>=Arrive, <span class="kbd">D</span>=Depart, <span class="kbd">N</span>=Navigate, <span class="kbd">F</span>=Follow, <span class="kbd">L</span>=Share</span>
    <div id="etaSummary" class="eta-summary" aria-live="polite"></div>
    <button id="btnHelp" aria-expanded="false" aria-controls="helpShortcuts" class="my-6" title="Toggle keyboard shortcuts">?</button>
    <div id="helpShortcuts" class="helpbox" role="region" aria-label="Keyboard Shortcuts">
      <div><span class="kbd">A</span> Arrive, <span class="kbd">D</span> Depart</div>
      <div><span class="kbd">N</span> Navigate, <span class="kbd">F</span> Follow Me, <span class="kbd">L</span> Share Location</div>
    </div>
    <div>
      <label for="routeSelect">Select Route</label>
      <label for="reason">Advance reason</label>
      <select id="reason" title="Advance reason">
          <option value="">(none)</option>
          <option value="depart">depart</option>
          <option value="arrive">arrive</option>
          <option value="pod">pod</option>
      </select>
      <button id="advance">Advance</button>
    </div>
    <div id="nextStop" class="card hidden"></div>
    <div id="dmap" class="map"></div>
    <button id="btnRecenter" class="mt-6">Re-center Map</button>
    <ul id="stopList" class="stops"></ul>
    <div class="mt-6">
      <label><input type="checkbox" id="shareLoc"/> Share Location</label>
      <label class="ml-8" for="shareInterval">Every</label>
      <input id="shareInterval" type="number" min="3" step="1" value="10" aria-label="Share interval seconds" /> s
      <label class="ml-8"><input type="checkbox" id="followMe"/> Follow Me</label>
      <button id="btnNavigate" class="ml-8">Navigate</button>
    </div>
    <pre id="routeOut" aria-live="polite" aria-atomic="true"></pre>
    <div id="reconn" class="banner" role="status">Reconnecting… <button id="btnRetrySSE" class="ml-8">Retry now</button></div>
  </section>
  <section id="pod">
    <h2>Proof of Delivery</h2>
    <div>
      <label>Order ID <input id="podOrderId" placeholder="ord_123"/></label>
      <label>Stop ID <input id="podStopId" placeholder="(auto from next stop)"/></label>
      <label>Type
        <select id="podType">
          <option value="signature">signature</option>
          <option value="photo">photo</option>
          <option value="note">note</option>
        </select>
      </label>
    </div>
    <div>
      <input type="file" id="podFile" aria-label="PoD file (jpg/png/webp)" accept="image/*"/>
      <small>Max 15 MB; allowed: jpg, png, webp.</small>
      <label class="ml-8">Note <input id="podNote" placeholder="optional"/></label>
      <button id="btnPod">Submit PoD</button>
    </div>
    <div id="podErr" class="err" role="alert"></div>
    <div id="podPreview" class="preview" aria-label="Preview"></div>
    <small>Note: Demo uploads call /v1/pod with metadata; presigned upload is mocked.</small>
    <pre id="podOut"></pre>
  </section>
  <section id="events">
    <h2>Events</h2>
    <button id="btnClearEvents">Clear</button>
    <pre id="eventsOut" aria-live="polite" aria-atomic="false"></pre>
  </section>
  <script src="/static/driver.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <div id="toast" class="toast" aria-live="polite" role="status"></div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/static/driver-sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
